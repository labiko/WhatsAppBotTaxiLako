<!DOCTYPE html>
<html>
<head>
    <title>ğŸ§ª Test Green API Direct</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        input, textarea, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { background: #f9f9f9; padding: 10px; border-radius: 5px; margin-top: 10px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Test Green API WhatsApp Direct</h1>
        
        <div class="section">
            <h3>ğŸ“‹ Configuration Green API</h3>
            <input type="text" id="instanceId" placeholder="Instance ID" value="7105303512">
            <input type="text" id="token" placeholder="Token" value="022e5da3d2e641ab99a3f70539270b187fbfa80635c44b71ad">
            <input type="text" id="baseUrl" placeholder="Base URL" value="https://api.green-api.com">
        </div>
        
        <div class="section">
            <h3>ğŸ“± Message Ã  envoyer</h3>
            <input type="text" id="phoneNumber" placeholder="NumÃ©ro de tÃ©lÃ©phone" value="33620951645">
            <textarea id="messageText" rows="4" placeholder="Message Ã  envoyer">ğŸš— MOTO assignÃ©e ! 

ğŸ§‘â€âœˆï¸ Conducteur: balde mamadou souarÃ©
ğŸ“ +224622111111 
ğŸš— toyota yaris (RC-898-54)

ğŸ’° 55 000 GNF â€¢ ArrivÃ©e dans â° 0 min

Le conducteur vous contactera bientÃ´t. Bon voyage! ğŸ›£ï¸</textarea>
        </div>
        
        <div class="section">
            <button onclick="sendMessage()">ğŸ“¤ Envoyer Message WhatsApp</button>
            <div id="result" class="result" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š Test avec CURL (Alternative)</h3>
            <textarea id="curlCommand" rows="6" readonly></textarea>
            <button onclick="generateCurl()">ğŸ”§ GÃ©nÃ©rer commande CURL</button>
        </div>
    </div>

    <script>
        function generateCurl() {
            const instanceId = document.getElementById('instanceId').value;
            const token = document.getElementById('token').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const phone = document.getElementById('phoneNumber').value;
            const message = document.getElementById('messageText').value;
            
            const curlCommand = `curl -X POST "${baseUrl}/waInstance${instanceId}/sendMessage/${token}" \\
-H "Content-Type: application/json" \\
-d '{
    "chatId": "${phone}@c.us",
    "message": "${message.replace(/\n/g, '\\n').replace(/"/g, '\\"')}"
}'`;
            
            document.getElementById('curlCommand').value = curlCommand;
        }
        
        async function sendMessage() {
            const instanceId = document.getElementById('instanceId').value;
            const token = document.getElementById('token').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const phone = document.getElementById('phoneNumber').value;
            const message = document.getElementById('messageText').value;
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'â³ Envoi en cours...';
            
            try {
                const url = `${baseUrl}/waInstance${instanceId}/sendMessage/${token}`;
                const payload = {
                    chatId: `${phone}@c.us`,
                    message: message
                };
                
                console.log('URL:', url);
                console.log('Payload:', payload);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>âœ… Message envoyÃ© avec succÃ¨s !</strong><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>RÃ©ponse:</strong><br>
                        <pre>${responseText}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>âŒ Erreur lors de l'envoi</strong><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Erreur:</strong><br>
                        <pre>${responseText}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ Erreur rÃ©seau</strong><br>
                    <strong>Erreur:</strong> ${error.message}
                `;
            }
        }
        
        // GÃ©nÃ©rer la commande CURL au chargement
        window.onload = function() {
            generateCurl();
        };
    </script>
</body>
</html>